# Learning Summary

## DeFi

### What's DeFi?

Decentralized finance (DeFi) is an emerging financial technology based on secure distributed ledgers similar to those used by cryptocurrencies. The system removes the control banks and institutions have on money, financial products, and financial services.

Some of the key attractions of DeFi for many consumers are:

- It eliminates the fees that banks and other financial companies charge for using their services.
- You hold your money in a secure digital wallet instead of keeping it in a bank.
- Anyone with an internet connection can use it without needing approval.
- You can transfer funds in seconds and minutes.

> **KEY TAKEAWAYS**
>
> - Decentralized finance, or DeFi, uses emerging technology to remove third parties in financial transactions.
> - The components of DeFi are stablecoins, software, and hardware that enables the development of applications.
> - The infrastructure for DeFi and its regulation are still under development and debate.

### Understanding DeFi

**Centralized Finance**

In centralized finance, your money is held by banks, corporations whose overarching goal is to make money. The financial system is full of third parties who facilitate money movement between parties, with each one charging fees for using their services. For example, say you purchase a gallon of milk using your credit card. The charge goes from the merchant to an [acquiring bank](https://www.investopedia.com/terms/a/acquirer.asp), which forwards the card details to the credit card network.

The network clears the charge and requests a payment from your bank. Your bank approves the charge and sends the approval to the network, through the acquiring bank, back to the merchant. Each entity in the chain receives payment for its services, generally because [merchants](https://www.investopedia.com/terms/m/merchant-account.asp) must pay for your ability to use credit and debit cards.

All other financial transactions cost money; loan applications can take days to be approved; you might not even be able to use a bank's services if you're traveling.

> Two of DeFi's goals are to reduce transaction times and increase access to financial services.

**Decentralized Finance**

Decentralized finance eliminates intermediaries by allowing people, merchants, and businesses to conduct financial transactions through emerging technology. This is accomplished through peer-to-peer financial networks that use security protocols, connectivity, software, and hardware advancements.

From anywhere you have an internet connection, you can lend, trade, and borrow using software that records and verifies financial actions in distributed financial databases. A distributed database is accessible across various locations; it collects and aggregates data from all users and uses a [consensus mechanism](https://www.investopedia.com/terms/c/consensus-mechanism-cryptocurrency.asp)(details about consensus mechanism [in this note](#consensus-algorithm-and-how-blockchain-works)) to verify it.

Decentralized finance uses this technology to eliminate centralized finance models by enabling anyone to use financial services anywhere regardless of who or where they are.

DeFi applications give users more control over their money through personal wallets and trading services that cater to individuals.

> **_IMPORTANT_**: While taking control away from third parties, decentralized finance does not provide anonymity. Your transactions may not have your name, but they are traceable by the entities that have access. These entities might be governments, law enforcement, or other entities that exist to protect people's financial interests.

### How Does DeFi Work?

Decentralized finance uses the blockchain technology that cryptocurrencies use. A blockchain is a distributed and secured database or ledger. Applications called dApps are used to handle transactions and run the blockchain.

In the blockchain, transactions are recorded in blocks and then verified by other users. If these verifiers agree on a transaction, the block is closed and encrypted; another block is created that has information about the previous block within it.

The blocks are "chained" together through the information in each proceeding block, giving it the name blockchain. Information in previous blocks cannot be changed without affecting the following blocks, so there is no way to alter a blockchain. This concept, along with other security protocols, provides the secure nature of a blockchain.

**DeFi Financial Products**

Peer-to-peer (P2P) financial transactions are one of the core premises behind DeFi. A P2P DeFi transaction is where two parties agree to exchange cryptocurrency for goods or services without a third party involved.

To fully understand this, consider how you get a loan in centralized finance. You'd need to go to your bank or another lender and apply for one. If you were approved, you'd pay interest and service fees for the privilege of using that lender's services.

> [Peer-to-peer lending](https://www.investopedia.com/articles/financial-theory/08/peer-to-peer-lending.asp) under DeFi doesn't mean there won't be any interest and fees. However, it does mean that you'll have many more options since the lender can be anywhere in the world.

In DeFi, you'd use your decentralized finance application (dApp) to enter your loan needs, and an algorithm would match you up with peers that meet your needs. You'd then need to agree to one of the lender's terms and receive your loan.

The transaction is recorded in the blockchain; you receive your loan after the consensus mechanism verifies it. Then, the lender can begin collecting payments from you at the agreed-upon intervals. When you make a payment via your dApp, it follows the same process in the blockchain; then, the funds are transferred to the lender.

**DeFi Currency**

DeFi is designed to use [cryptocurrency](https://www.investopedia.com/terms/c/cryptocurrency.asp) for transactions. The technology is still developing, so it is difficult to determine precisely how existing cryptocurrencies will be implemented, if at all. Much of the concept revolves around stablecoin, a cryptocurrency backed by an entity or pegged to fiat currency like the dollar.

### The Future of DeFi

Decentralized finance is still in the beginning stages of its evolution. For starters, it is unregulated, which means the ecosystem is still riddled with infrastructural mishaps, hacks, and scams.

Current laws were crafted based on the idea of separate financial jurisdictions, each with its own set of laws and rules. DeFi’s borderless transaction ability presents essential questions for this type of regulation. For example, who is responsible for [investigating a financial crime](https://www.investopedia.com/terms/f/fincen.asp) that occurs across borders, protocols, and DeFi apps? Who would enforce the regulations, and how would they enforce them?

> The decentralized finance ecosystem's open and distributed nature might also pose problems to existing financial regulation.

Other concerns are system stability, energy requirements, carbon footprint, system upgrades, system maintenance, and hardware failures.

Many questions must be answered and advancements made before DeFi becomes safe to use. Financial institutions are not going to let go of one of their primary means of making money—if DeFi succeeds, it's more than likely that banks and corporations will find ways to get into the system; if not to control how you access your money, then at least to make money from the system.

### DeFi Projects Map

<div style="text-align:center; width: 100%"><img src="https://the-defiant-web.s3.amazonaws.com/img/2020/10/24172812/DeFi_Map_-_The_Defiant.png" alt="Ethereum DeFi Projects Map" ></img></div>

<div style="text-align:center; width: 100%">(Ethereum DeFi Projects Map)</div>

#### Trading

Decentralized exchanges or DEXs are platforms which enable the exchange of digital assets on-chain and without relying on centralized intermediaries. These platforms are open for anyone, anywhere to use without, and users retain control of their private keys and assets.

去中心化交易平台 DEX（Kybernetwork, Uniswap, Balancer, Curve, 1inch）

主要操作：

- 基本的代幣轉換（Token Swap）
- 進行流動性挖礦（[Liquidity Mining](#liquidity-mining-lp-mining-and-lp-mining-smart-contracts)）

這一類型的服務其實是最早出現於 DeFi 領域的服務，也就是去中心化交易平台 DEX (Decentralized Exchange, DEX)，元老 EthFinex、IDEX 和 EtherDelta 等交易所其實與我們現今在使用的 CEX 如 Binance, FTX 一樣都是利用訂單簿（order book）的方式進行交易，平台搓合平台買賣方進行 token 的成交。

差別在於，任何人都可以在 DEX 當中增設你想要交易的代幣，我們不再需要苦苦等待交易所上幣的消息，而交易過後的代幣，進到的是自己的口袋，並非中心化交易所的用戶錢包，自己擁有所有資產的掌控權，DeFi 且無須許可的操作在 DEX 當中表露無遺。

只可惜 order book 的方式其實並非最適合 DeFi 生態的交易方式，由於許多新出現於市場上的 defi token 並沒有足夠的流動性在單一的 DEX 中供使用者交易，這一個難題於使用「[自動做市商- AMM （Automated Market Maker）](#uniswap-amm-mechanisms)」機制的 DEX 出現後慢慢得到了改善，透過匯集交易流動性的效果，交易者並非如以往一樣是以交易所中的買賣方進行互動，所有需要買賣代幣的使用者都是與 AMM 機制當中的流動池所交互，如此大大改善了 DEX 以往流動性不足的問題，如 Uniswap, Balancer, Curve，這些協議在 AMM 的設計當中都有著些微差異想要去解決現有問題，如 Balancer 不限於進行兩種 token 的交易、Curve 更利於穩定幣的交易等等。

而這些交易平台隨著流動性挖礦的熱潮出現之後，更湧入了非常多的使用者針對這些協議進行提供流動性的動作，目前這些協議的 TVL 也有著非常大的成長。

#### Lending

DeFi lending protocols provide users with the ability to lend their digital assets in exchange for return on their deposits, and borrow cryptocurrencies against collateral, without intermediaries.

借放貸服務平台（MakerDAO, Compound, Aave）

主要操作：

- 存放加密貨幣領取利息，適合低風險操作投資者
- 存放加密貨幣借款出來槓桿操作，適合中高風險操作投資者

Maker、Compound、Aave ：提到 DeFi , 當然不能錯過 2020 年引爆流動性挖礦熱潮的去中心化借貸平台 Compound，還有 DeFi 元老級項目 Maker 等平台，在這些平台中，使用者透過這些平台搓合與其他用戶的借放款執行，更靈活地分配自己手上持有的加密貨幣資產，非常適合有閒置資或是想要長期持有代幣的投資者操作，透過放貸 BTC, ETH 以及其他穩定幣 USDT, USDC 等幣種，享有穩定於 8-20% 的年化收益。

#### Derivatives

Derivatives platforms in DeFi offer the issuance and trading of digital assets which are representations of financial instruments, from fiat currencies to indexes and options.

衍生品交易平台（Perpetual Protocol, Opyn, Synthetix）

- 交易加密貨幣衍生品如期貨、期權等

提到金融衍生商品，或許對於一般讀者較不熟悉，平常也不會去使用，而幣圈中的交易更以現貨居多，常見的衍生商品如槓桿、合約或是期貨操作起來也有一定的風控門檻需要學習，衍生品的定義非常的廣，包含各種實體價值衍生而成的複合性商品（指數、利率、匯率）或是有別於現貨更加進階的金融工具如期貨、期權等等。

這一類型的團隊如 永續合約交易平台 Perpetual Protocol, 期權 Opyn 以及 合成資產協議元老 Synthetix 都是大家十分關注的項目，以往大家其實十分排斥在 DeFi 進行 token 的交易，更遑論交易衍生品，起因於交易手續費過高以及交易速度上無法與中心化交易所匹敵，交易流動性的不足以及交易速度對於資金量體大的用戶來說實在沒有誘因去使用，而自從 Layer 2 solution 的出現之後，許多協議分分接入 matic, xdai (Perpetual Protocol ), optimism(Synthetix) 等架構，改善了以往的許多痛點。

#### Custody

Ethereum wallets which allow for the self-custody of users’ private keys and digital assets. This means individuals are in control of their funds at all times, and don’t need to trust a centralized entity, reducing the risk of hacks. These wallets are the gateways through which users can interact with DeFi applications.

熱錢包、資產儲存（Metamask, Trust Wallet, Instadapp）

主要操作：

- 主要為存放加密貨幣的去中心化錢包，進行 DeFi 協議的操作

這一類的服務提供用戶資產存放及管理的服務，不同於傳統的金融機構。可使用的如常見的錢包（ Metamask, MyEtherWallet 、Trust Wallet ）、手機端的 app （argent）及網路端應用的儀表板（ Dashboard ）等。其中不乏有即時轉幣（Swap）功能以及提供一鍵質押等功能， 如 Instadapp 就提供 Compound, Curve, Aave, MakerDAO 等協議的接入，用戶可以直接透過 Instadapp 進行借放貸以及流動性挖礦的操作，也可以直接透過 Instadapp 上查看現時數據，流程上十分簡便。

#### Oracles

[Oracles](https://betterprogramming.pub/what-is-a-blockchain-oracle-f5ccab8dbd72) are ways to get data into and out of smart contracts. We should be getting our data from multiple independent decentralized sources.

預言機（Chainlink, Band Protocol, Tellor, Nest Protocol, DIA）

預言機一詞並不源自於區塊鏈技術，它來自於早期的電腦抽象設計，在密碼學等領域內也都有類似的概念。

主要是如果存在於智能合約中的數據與外界無法進行同步，那麼智能合約將會無法於現實生活為人們所使用，所以各個 DeFi 協議如果要維持運作上的順利，使用預言機來為智能合約同步外部可靠的數據源將會是必須的。

可以想像預言機為結合 DeFi 協議上的數據與外部數據源的橋樑，也因此預言機板塊受到這麼多人的看重，隨著 Chainlink 的出現之後，Band Protocol (BAND) , Tellor (TRB) , Nest Protocol (NEST) , DIA 也接連問世。

#### Insurance

These projects offer protection against smart contract vulnerabilities or price volatility, aggregating community funds to use as cover.

保險協議（Nexus Mutual, Cover Protocol, Unslashed）

主要操作：

- 質押 token，需付利息來保障自己在其他協議中存放的資產
- 質押協議需要的 token 來進行 yield farming 獲取利息

提到 DeFi 的保險協議，一直都是個喜憂參半的事，這些保險協議出現的原是因為防止 DeFi 用戶存放許多資產到協議遭到駭客攻擊而損失資產而生，與大家生活中需要繳固定保費一樣，這些保險協議也可以透過付出一定的利息來與自己鎖倉至不同 DeFi 協議的資產作對沖，假如不行真的該協議被駭客攻擊了，也可以因為自己先前有與保險協議交互而領取保險金。

而每個保險協議執行的方式都不盡相同， Nexus Mutual 如其名，是一個去中心化的保險互助協議，透過 KYC 成為會員的用戶可以利用 NXM 代幣購買其提供的保險，當所保護的智能合約遭受到駭客攻擊時，投保的用戶可以進行索賠。

Unslashed.fianance 是另一個特別的 DeFi 保險協議，特別之處在於 Unslashed Finance 為用戶提供了一種能夠在大範圍的產品與協議中保護用戶的機制。該保護機制透過用戶購買，並透過向平台提供資金與來進行保險。

這些資金提供用戶（capital supplier）透過質押以太（ETH）來可以挖取 USF token 作為收益（Capital Mining），隨後他們也推出了 Cover Mining，透過購買上面的保險，也能同時挖取 USF token 作為收益。

#### Asset Management

Protocols enabling users to better manage and visualize their portfolios, via an array of tools including automated strategies and routing funds to highest-yielding lending pools.

資產管理（Set Protocol, Zapper, Zerion）

主要操作：

- 購買 token 的指數產品
- 資產管理與紀錄

這一類型的協議著重在資產管理、交易紀錄儀表板以及提供加密貨幣策略組合的平台

其中，建立於 Set Protocol 之上的 Token Set 可以視為是加密貨幣的資產管理 + 社群交易平台，購買指數或是金融產品不會再像以往金融業理專讓你買的連成分股或是內扣費用都不清楚，Token Set 上面的指數產品包含組成幣種，歷史價格、 Rebase 時間、手續費全部都是公開透明而且交易紀錄皆可以在區塊鏈上查看，同時也有像大家耳熟能詳的 Etoro 一樣，能夠自行挑選喜歡的 trader 所推出的指數。

#### Cross-chain

跨鏈協議（Ren, Keep Network）

主要操作：

- 將以太坊以外的其他鏈上資產轉到以太坊上進行 DeFi 的操作（如可以將 wBTC 轉為 crvRenWBTC 並質押在 Harvest.finance、BadgerDAO 等 DeFi 協議裡面）

顧名思義，跨鏈協議讓用戶可以將 token 更輕易將不同資產不同的鏈之間實現去中心化、無許可制的跨鏈資產轉移，以最常見的 Ren 來說，暗池服務出身的 Ren 先前推出的旗下產品 RenVM 提供了用戶更簡易的跨鏈轉移解決方案，用戶可以將 BTC、BCH、ZEC 簡單傳送至以太坊，以 BTC 來說，就能夠以 BTC 來轉換成近乎等值的 renBTC。

同樣的， 隱私跨鏈協議 Keep Network 也推出了 tBTC 的資產跨鏈方案，tBTC 的來頭也不小，受到非常多加密貨幣產業中的創投青睞如 a16z、Polychain、Paradigm 等機構投資，而 Kava 也於先前公布之後將會計畫 BTC 跨鏈的服務。

我們可以預見，隨著跨鏈資產服務的推出，將不同鏈上的資產逐漸整合至以太坊的 DeFi 上，如此便會進一步擴增 DeFi 生態的規模，同時會有更多服務衍生而出。

## DeFi Terminology

- Collateral loan: 抵押贷款
- Farm: 可以透過 token 來質押生利息的協議（或是稱項目），通常分為單幣質押（Yield Farming）或是流動性挖礦兩種（Liquidity Mining）。
- Farmer: 每天都在尋找哪裡有好玩的 farm 可以收取利息的 DeFi 玩家
- 流動性挖礦 Liquidity mining: 首先質押兩個交易對的幣種到去中心化交易所如 uniswap、balancer、sushiswap 等，再透過質押去中心化交易所得到的流動性提供權證（LP），再抵押到該智能合約當中的流動池中獲得收益，通常需要 2 層或是 2 層以上的操作。
- Stake: 質押，將手上的 token 與智能合約互動質押進農場中獲取利息。
- AMM（Automated Market Maker）自動做市商: 為去中心化交易所後來演化並受到大眾採用的一個機制，如 Uniswap（UNI）, Sushiswap（SUSHI）, Curve（CRV）, Balancer（BAL） 以及始祖 Bancor 等等，而各個 AMM 的交易公式也稍有不同，而 Uniswap 的恆定乘積做市商模型（Constant Product Market Maker Model）則為 XY = K, Balancer 則是 XY \* Z = K，支援多幣種的轉換([Read more](https://medium.com/@cic.ethan/%E6%B7%BA%E8%AB%87%E8%87%AA%E5%8B%95%E5%81%9A%E5%B8%82%E5%95%86-amms-%E6%A9%9F%E5%88%B6-%E5%BE%9E-uniswap-%E7%90%86%E8%A7%A3-balancer-999b700c001))，Curve 則是設計為專提供使用者可以更好轉換不同穩定幣轉換的一個地方。
- Liqidity provider (LP): 流動性提供者，透過直接質押代幣到 Uniswap 這類的 AMM 會得到一個流動性提供權證 LP token 如 ETH USDT-LP, 有些農場可以再藉由這類型的 token 質押到池子裡進行二次收取利息的效益。
- APY（Annual Percentage Yield）年化利率: 其實照理說應該是 APR（Annual Percentage Rate）, APY 是加上複利過後的利率，而每個農場計算利率的方式也不同
- Impermanent loss (IL) 無常損失: 如果要組成 LP token 如 ETH-UNI LP 去挖礦的話，其中一個代幣價格如果下跌與單純持有現貨的損失間的差距稱為「無常損失」，所以許多人為了避險或是減少損失，會利用交易所的合約來開空自己所想要投入的幣種。
- liquidate 清算: 質押某 token 借幣出來時，如果借出來的幣漲太多或是抵押的幣跌太多，會造成原本質押的 token 被賣掉清算倉位。
- 一池、二池: 可以透過穩定幣或是原本手上就有的幣質押來生利息的池為一池（如 ETH Pool, wBTC Pool, UNI Pool），需要透過農場原生 token 質押、組 LP 才能收取利息的池為二池，這類型的池操作較為複雜，風險也較高，但也有機率因為組 LP 的兩個 token 都上漲而獲利更多。
- Total value locked (TVL): the sum of all cryptocurrencies staked, loaned, deposited in a pool, or used for other financial actions across all of DeFi. It can also represent the sum of specific cryptocurrencies used for financial activities, such as ether or bitcoin. 指 DeFi 參與者目前質押在該 DeFi 協議中的整體資金，可以視為目前市場參與的資金份額，隨著 TVL 的上升，DeFi 協議的收益獲利百分比也會趨於穩定（可以想成整個協議的參與者均分固定收益，金額波動越小，APY 也較固定）相關數據可以透過 coinmarketcap 的 farming 區以及 Defi Pulse 來檢視，通常 TVL 越低風險也越高，因為越容易受到大資金的進出而影響 APY，不過如果是能夠在農場開始時就搶入頭礦則可以享受到非常高額的收益。
- Vault: 顧名思義為金庫的意思，通常在 DeFi 協議中指的是 「機槍池」，也就是能夠最大化用戶獲利策略的資金池，以 yearn.finance（YFI）來說，Vault 的策略可能不只是單純放貸或是提供流動性等單一的操作而已，比如幫助用戶參與流動性挖礦同時之後能夠將帶幣賣出獲利，又或者借幣來提供流動性達到有槓桿效益的成效，而這些策略以及當中參數（手續費、收益、抵押率等）都會是經由社群的投票所決定的。
- Mint: 鑄造，指質押 A 代幣生成 B 代幣的過程，以便可以使用該協議生態內的工具或是服務，如在 Fantom 上，你可以利用你的 FTM token 鑄造 fUSD 代幣，使用它提供的服務。
- Rug pull: 直譯為抽地毯的意思，DeFi 協議中的智能合約有漏洞造成平台被駭客攻擊，使用者資金損失
- Time Lock: 團隊代幣份額有沒有時間鎖，而不是智能合約上線後就可以在高價位惡意砸盤，造成風險極大，也是一個需要確定的因素。
- Audit: 該項目是否有經過智能合約審計，常見的審計團隊有 Quantstamp、Peckshield，另外還有 Consensys
  Open zeppelin、Trail of bits 等等。
- Fair Launch: 公平發行，指開發團隊不會預先挖出代幣，而團隊通常都需要解鎖才會拿到代幣，因此流動性會先往散戶移動，較不會有砸盤壓力。

## Credits

- [【De-Fi 系列】談 DeFi 的起源、介紹及未來發展（上）](https://cryptowesearch.com/blog/all/defi-intro1)
- [Decentralized Finance (DeFi) Definition](https://www.investopedia.com/decentralized-finance-defi-5113835)
- [Ethereum DeFi Projects Map](https://thedefiant.io/defi-projects-map)
